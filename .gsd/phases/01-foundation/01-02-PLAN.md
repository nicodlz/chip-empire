---
phase: 1
plan: 02
wave: 2
depends_on: [01-01]
autonomous: true
---

# Plan 01-02: Game Data & Engine

## Objective

Define real minerals data, create resource engine with Decimal support, build Zustand store.

## Tasks

<task type="auto">
  <name>Define mineral types and data</name>
  <files>src/types/game.ts, src/data/minerals.ts</files>
  <action>
    src/types/game.ts:
    ```typescript
    import Decimal from 'break_eternity.js'

    export type MineralId = 
      | 'silicon' | 'copper' | 'aluminum'  // Tier 1
      | 'gold' | 'silver' | 'tin'          // Tier 2
      | 'lithium' | 'cobalt' | 'tantalum'  // Tier 3
      | 'neodymium' | 'gallium' | 'indium' // Tier 4
      | 'germanium' | 'hafnium'            // Tier 5

    export interface MineralDef {
      id: MineralId
      name: string
      symbol: string
      emoji: string
      tier: 1 | 2 | 3 | 4 | 5
      color: string  // Tailwind color
      baseRate: number  // Per tap multiplier
    }

    export interface MineralState {
      amount: Decimal
      total: Decimal
      unlocked: boolean
    }

    export interface GameState {
      minerals: Record<MineralId, MineralState>
      miningPower: Decimal
      lastTick: number
    }
    ```

    src/data/minerals.ts:
    ```typescript
    import { MineralDef, MineralId } from '../types/game'

    export const MINERALS: Record<MineralId, MineralDef> = {
      // Tier 1 - Common
      silicon:   { id: 'silicon',   name: 'Silicon',   symbol: 'Si', emoji: 'ï¿½ite', tier: 1, color: 'blue',   baseRate: 1 },
      copper:    { id: 'copper',    name: 'Copper',    symbol: 'Cu', emoji: 'ðŸŸ¤', tier: 1, color: 'orange', baseRate: 0.8 },
      aluminum:  { id: 'aluminum',  name: 'Aluminum',  symbol: 'Al', emoji: 'â¬œ', tier: 1, color: 'slate',  baseRate: 0.6 },
      
      // Tier 2 - Metals
      gold:      { id: 'gold',      name: 'Gold',      symbol: 'Au', emoji: 'ðŸ¥‡', tier: 2, color: 'yellow', baseRate: 0.3 },
      silver:    { id: 'silver',    name: 'Silver',    symbol: 'Ag', emoji: 'ðŸ¥ˆ', tier: 2, color: 'gray',   baseRate: 0.4 },
      tin:       { id: 'tin',       name: 'Tin',       symbol: 'Sn', emoji: 'ðŸ”˜', tier: 2, color: 'zinc',   baseRate: 0.5 },
      
      // Tier 3 - Rare Earth
      lithium:   { id: 'lithium',   name: 'Lithium',   symbol: 'Li', emoji: 'ðŸ”‹', tier: 3, color: 'green',  baseRate: 0.15 },
      cobalt:    { id: 'cobalt',    name: 'Cobalt',    symbol: 'Co', emoji: 'ðŸ”µ', tier: 3, color: 'indigo', baseRate: 0.12 },
      tantalum:  { id: 'tantalum',  name: 'Tantalum',  symbol: 'Ta', emoji: 'âš«', tier: 3, color: 'violet', baseRate: 0.1 },
      
      // Tier 4 - Exotic
      neodymium: { id: 'neodymium', name: 'Neodymium', symbol: 'Nd', emoji: 'ðŸ§²', tier: 4, color: 'pink',   baseRate: 0.05 },
      gallium:   { id: 'gallium',   name: 'Gallium',   symbol: 'Ga', emoji: 'ðŸ’§', tier: 4, color: 'cyan',   baseRate: 0.04 },
      indium:    { id: 'indium',    name: 'Indium',    symbol: 'In', emoji: 'âœ¨', tier: 4, color: 'teal',   baseRate: 0.03 },
      
      // Tier 5 - Ultra-rare
      germanium: { id: 'germanium', name: 'Germanium', symbol: 'Ge', emoji: 'ðŸ’Ž', tier: 5, color: 'purple', baseRate: 0.01 },
      hafnium:   { id: 'hafnium',   name: 'Hafnium',   symbol: 'Hf', emoji: 'âš¡', tier: 5, color: 'rose',   baseRate: 0.005 },
    }

    export const MINERAL_ORDER: MineralId[] = Object.keys(MINERALS) as MineralId[]
    export const TIER_1_MINERALS: MineralId[] = ['silicon', 'copper', 'aluminum']
    ```
  </action>
  <verify>Types import without errors</verify>
  <done>15 real minerals defined with properties</done>
</task>

<task type="auto">
  <name>Create resource engine</name>
  <files>src/engine/resources.ts</files>
  <action>
    ```typescript
    import Decimal from 'break_eternity.js'
    import { MineralState, MineralId } from '../types/game'
    import { MINERALS } from '../data/minerals'

    export function createMineralState(unlocked = false): MineralState {
      return {
        amount: new Decimal(0),
        total: new Decimal(0),
        unlocked,
      }
    }

    export function addMineral(state: MineralState, amount: Decimal): MineralState {
      return {
        ...state,
        amount: state.amount.plus(amount),
        total: state.total.plus(amount),
      }
    }

    export function mineMineral(mineralId: MineralId, power: Decimal): Decimal {
      const def = MINERALS[mineralId]
      return power.times(def.baseRate)
    }

    export function formatNumber(n: Decimal): string {
      if (n.lt(1000)) return n.toFixed(n.lt(10) ? 1 : 0)
      if (n.lt(1e6)) return n.div(1000).toFixed(1) + 'K'
      if (n.lt(1e9)) return n.div(1e6).toFixed(1) + 'M'
      if (n.lt(1e12)) return n.div(1e9).toFixed(1) + 'B'
      if (n.lt(1e15)) return n.div(1e12).toFixed(1) + 'T'
      return n.toExponential(2)
    }
    ```
  </action>
  <verify>Functions handle Decimal correctly</verify>
  <done>Resource math is pure and testable</done>
</task>

<task type="auto">
  <name>Create Zustand game store</name>
  <files>src/store/gameStore.ts</files>
  <action>
    ```typescript
    import { create } from 'zustand'
    import { persist, StorageValue } from 'zustand/middleware'
    import Decimal from 'break_eternity.js'
    import { GameState, MineralId } from '../types/game'
    import { createMineralState, addMineral, mineMineral } from '../engine/resources'
    import { MINERALS, TIER_1_MINERALS } from '../data/minerals'

    interface GameStore extends GameState {
      mine: (mineralId: MineralId) => void
      unlockMineral: (mineralId: MineralId) => void
      reset: () => void
    }

    const createInitialState = (): GameState => ({
      minerals: Object.fromEntries(
        Object.keys(MINERALS).map(id => [
          id,
          createMineralState(TIER_1_MINERALS.includes(id as MineralId))
        ])
      ) as Record<MineralId, any>,
      miningPower: new Decimal(1),
      lastTick: Date.now(),
    })

    // Decimal serialization
    const serialize = (state: StorageValue<GameState>) => 
      JSON.stringify(state, (_, v) => v instanceof Decimal ? `__D__${v.toString()}` : v)

    const deserialize = (str: string): StorageValue<GameState> =>
      JSON.parse(str, (_, v) => typeof v === 'string' && v.startsWith('__D__') ? new Decimal(v.slice(5)) : v)

    export const useGameStore = create<GameStore>()(
      persist(
        (set) => ({
          ...createInitialState(),

          mine: (mineralId) => set((state) => {
            const mineral = state.minerals[mineralId]
            if (!mineral.unlocked) return state
            
            const gained = mineMineral(mineralId, state.miningPower)
            return {
              minerals: {
                ...state.minerals,
                [mineralId]: addMineral(mineral, gained),
              },
            }
          }),

          unlockMineral: (mineralId) => set((state) => ({
            minerals: {
              ...state.minerals,
              [mineralId]: { ...state.minerals[mineralId], unlocked: true },
            },
          })),

          reset: () => set(createInitialState()),
        }),
        {
          name: 'chip-empire-save',
          storage: {
            getItem: (name) => {
              const str = localStorage.getItem(name)
              return str ? deserialize(str) : null
            },
            setItem: (name, value) => localStorage.setItem(name, serialize(value)),
            removeItem: (name) => localStorage.removeItem(name),
          },
        }
      )
    )
    ```
  </action>
  <verify>Store persists and rehydrates</verify>
  <done>mine() works, persists to localStorage</done>
</task>

## Must-Haves

- [ ] 15 real minerals defined
- [ ] Tier system (1-5)
- [ ] Decimal.js handles big numbers
- [ ] Store persists correctly
- [ ] mine() increments correct mineral
